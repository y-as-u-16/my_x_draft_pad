# X Draft Pad 設計書（Flutter + SQLite + 広告＋Xネイティブ風UI）

## 1. アプリ概要

- **アプリ名（仮）**：X Draft Pad
- **プラットフォーム**：Android / iOS（Flutter）
- **目的**：
  - X（旧Twitter）に投稿するテキストの下書き・管理
  - 文字数（Xの投稿上限）を意識しながら推敲できる
  - ワンタップでXに投稿できる
  - 広告（AdMob）による収益化
- **UIコンセプト**：
  - X（旧Twitter）公式UIに寄せたネイティブ風デザイン
  - ダークモード・ライトモードの両対応
  - ボーダーライン区切りによるタイムライン風レイアウト
  - ピル型ボタン、円形プログレスカウンターなどX準拠のUIパーツ
  - 投稿先と近い見た目で推敲できる一貫した体験

---

## 2. 要件定義

### 2.1 機能要件

#### F-1. 下書き作成・編集

- 複数行テキスト入力
- リアルタイム文字数カウント
  - 総文字数
  - 残り文字数（デフォルト280）
  - 上限超過時は残り数値を赤表示
- 下書き保存（新規・更新）

#### F-2. 下書き一覧

- SQLiteに保存された下書き一覧表示（新しい順）
- 表示項目：
  - 先頭数十文字（例：30文字）
  - 更新日時
- 操作：
  - タップ → 編集画面へ遷移
  - スワイプ削除 or 長押し削除

#### F-3. Xへの投稿

- 編集画面の「Xで投稿」ボタンから
- OS共有シートを利用してXアプリの投稿画面にテキストを渡す
- 公式APIは使用しない

#### F-4. 設定

- 上限文字数の変更
  - デフォルト：280
- テーマ切り替え（ライト / ダーク）※対応可能な範囲で

#### F-5. 広告

- バナー広告表示
  - 一覧画面下部
  - 編集画面下部

### 2.2 非機能要件

- オフライン動作（SQLiteのみで完結）
- 操作レスポンスの良さ
- 端末ローカル保存のため、ユーザーの文章を外部送信しない
- 将来的にバックエンド連携（Firebase / Supabase）を追加できる設計

---

## 3. UI設計（Xネイティブ風）

### 3.1 カラーパレット

#### ダークテーマ（メインテーマ）

| 用途 | カラーコード |
|------|-------------|
| 背景 | `#000000`（ブラック） |
| サーフェス / カード | `#16181C` |
| ボーダー / 区切り線 | `#2F3336` |
| 文字色（メイン） | `#E7E9EA` |
| サブテキスト | `#71767B` |
| アクセント | `#1D9BF0`（Xブルー） |
| 警告（文字数超過） | `#F4212E` |
| 成功 / 許容範囲内 | `#00BA7C` |

#### ライトテーマ

| 用途 | カラーコード |
|------|-------------|
| 背景 | `#FFFFFF` |
| サーフェス / カード | `#F7F9F9` |
| ボーダー / 区切り線 | `#EFF3F4` |
| 文字色（メイン） | `#0F1419` |
| サブテキスト | `#536471` |
| アクセント | `#1D9BF0`（Xブルー） |
| 警告（文字数超過） | `#F4212E` |
| 成功 / 許容範囲内 | `#00BA7C` |

### 3.2 共通スタイル定義

**レイアウト方針**：
- 要素の区切りはボーダーライン（1px、ボーダー色）で行う。カード影は使用しない
- 背景色とサーフェス色の使い分けで階層を表現

**共通パーツ**：
- **ピル型ボタン**：`BorderRadius.circular(9999)`、背景アクセントブルー、白文字、高さ36px
- **アウトラインボタン**：ピル型＋ボーダーのみ（塗りなし）
- **アイコンボタン**：24x24アイコン、タップ領域40x40、サブテキスト色
- **円形プログレスカウンター**：残り文字数を円弧で表示（X公式と同様）
  - 通常時：アクセントブルー
  - 残り20文字以下：`#FFD400`（イエロー警告）
  - 超過時：`#F4212E`（レッド）
- **テキストスタイル**：システムフォント、見出し太字（FontWeight.w700）、本文通常（w400）
- **角丸**：カード類は `BorderRadius.circular(16)`、ボタンはピル型（9999）
- **ボトムシート / ダイアログ**：背景サーフェス色、上部に小さなハンドルバー

### 3.3 画面ごとのUIコンセプト

#### G1：下書き一覧画面

- **背景**：テーマ背景色（ダーク: `#000000` / ライト: `#FFFFFF`）
- **AppBar**：
  - 背景と同色でフラット、下部にボーダーライン
  - タイトル「X Draft Pad」＋右に設定アイコン
- **下書き一覧**：
  - タイムライン風リスト表示
  - 各アイテムはボーダーラインで区切り（カード影なし）
  - プレビューテキスト（メイン文字色）＋更新日時（サブテキスト色）
- **FAB**：
  - X公式と同様のピル型 or 丸型ボタン
  - 背景アクセントブルー、アイコン白「+」
  - 右下固定配置

#### G2：下書き編集画面

- **画面上部**：
  - AppBarにキャンセル（×）ボタンと保存ボタン（ピル型、アクセントブルー）
- **テキスト入力エリア**：
  - 装飾なしのTextField、背景と同色
  - X投稿画面風の広いテキストエリア
  - ヒントテキストはサブテキスト色
- **下部ツールバー**：
  - 上部にボーダーライン
  - 左側：「Xで投稿」ボタン（アウトラインピル型）
  - 右側：円形プログレス文字カウンター＋残り文字数テキスト
- **レイアウト**：X公式の投稿画面を意識した構成

#### G3：設定画面

- 各設定項目をボーダーライン区切りのリスト形式で表示
- セクションヘッダー（サブテキスト色、小さめフォント）
- スイッチはX公式風のトグル（アクセントブルー）
- タップ可能な項目は右端にシェブロン（>）アイコン

---

## 4. 画面構成

### 4.1 画面一覧

1. **G1**：下書き一覧画面
2. **G2**：下書き編集画面
3. **G3**：設定画面

### 4.2 G1：下書き一覧画面

**機能**：
- 下書き一覧表示
- 下書き新規作成
- 下書き削除
- 設定画面への遷移

**UI構成**：
- AppBar（タイトル＋設定アイコン、下部ボーダーライン）
- ListView（ボーダーライン区切りのタイムライン風リスト）
- 右下にピル型 or 丸型FAB（アクセントブルー背景、白「+」アイコン）
- 最下部にバナー広告領域

### 4.3 G2：下書き編集画面

**機能**：
- 下書き新規作成 / 編集
- 文字数カウント（円形プログレス）
- Xへの投稿
- 下書き保存

**UI構成**：
- AppBar（左：キャンセル（×）ボタン、右：保存ピル型ボタン（アクセントブルー））
- 中央：装飾なしの大きなTextField（背景と同色、X投稿画面風）
- 下部ツールバー（上部ボーダーライン）
  - 左側：「Xで投稿」アウトラインピル型ボタン
  - 右側：円形プログレス文字カウンター＋残り文字数
- バナー広告

### 4.4 G3：設定画面

**機能**：
- 上限文字数設定
- テーマ切り替え（ライト / ダーク）

**UI構成**：
- AppBar（戻るボタン＋タイトル、下部ボーダーライン）
- ボーダーライン区切りのリスト形式
  - 上限文字数：ラベル＋現在値＋シェブロン（タップでダイアログ）
  - テーマ切り替え：ラベル＋トグルスイッチ（アクセントブルー）
  - アプリ情報：アプリ名＋バージョン

---

## 5. データ設計（SQLite）

### 5.1 テーブル一覧

- **drafts**：下書きデータ本体
- **app_settings**：アプリ設定

### 5.2 drafts テーブル

**テーブル名**：`drafts`

| カラム名 | 型 | NOT NULL | 主キー | 説明 |
|---------|-----|----------|--------|------|
| id | INTEGER | YES | YES | 自動採番ID |
| content | TEXT | YES | | 下書き本文 |
| created_at | INTEGER | YES | | 作成日時（epoch millis） |
| updated_at | INTEGER | YES | | 更新日時（epoch millis） |

**CREATE TABLE 例**
```sql
CREATE TABLE drafts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  content TEXT NOT NULL,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
);
```

### 5.3 app_settings テーブル（任意）

**テーブル名**：`app_settings`

| カラム名 | 型 | NOT NULL | 主キー | 説明 |
|---------|-----|----------|--------|------|
| key | TEXT | YES | YES | 設定キー |
| value | TEXT | YES | | 設定値（JSONや文字列） |

**例**：
- `("max_length", "280")`

---

## 6. モデル設計（Dart）

### 6.1 Draft モデル
```dart
class Draft {
  final int? id;
  final String content;
  final DateTime createdAt;
  final DateTime updatedAt;

  Draft({
    this.id,
    required this.content,
    required this.createdAt,
    required this.updatedAt,
  });

  Draft copyWith({
    int? id,
    String? content,
    DateTime? createdAt,
    DateTime? updatedAt,
  }) {
    return Draft(
      id: id ?? this.id,
      content: content ?? this.content,
      createdAt: createdAt ?? this.createdAt,
      updatedAt: updatedAt ?? this.updatedAt,
    );
  }

  factory Draft.fromMap(Map<String, dynamic> map) {
    return Draft(
      id: map['id'] as int?,
      content: map['content'] as String,
      createdAt: DateTime.fromMillisecondsSinceEpoch(map['created_at'] as int),
      updatedAt: DateTime.fromMillisecondsSinceEpoch(map['updated_at'] as int),
    );
  }

  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'content': content,
      'created_at': createdAt.millisecondsSinceEpoch,
      'updated_at': updatedAt.millisecondsSinceEpoch,
    };
  }
}
```

---

## 7. SQLiteアクセス設計

### 7.1 使用パッケージ

- `sqflite`
- `path`

### 7.2 AppDatabase クラス

**責務**：
- DBインスタンスのシングルトン管理
- テーブル作成 / マイグレーション

**メソッド例**：
- `Future<Database> get database`
- `_onCreate(Database db, int version)`
- `_onUpgrade(Database db, int oldVersion, int newVersion)`

### 7.3 DraftDao クラス

**責務**：
- draftsテーブルのCRUD

**メソッド例**：
```dart
abstract class DraftDao {
  Future<int> insertDraft(Draft draft);
  Future<int> updateDraft(Draft draft);
  Future<int> deleteDraft(int id);
  Future<List<Draft>> getAllDrafts();
  Future<Draft?> getDraftById(int id);
}
```

実装クラスで sqflite を利用。

---

## 8. 文字数カウント仕様

- **カウント対象**：`String.characters.length`（絵文字を1文字としてカウント）
- **上限文字数**：設定値（デフォルト280）
- **表示**：
  - 現在文字数：`124`
  - 残り文字数：`+156`（上限 − 現在）
  - 超過時：`-10`（赤色表示）

---

## 9. X投稿連携仕様

- **パッケージ**：`share_plus`（予定）
- **フロー**：
  1. 「Xで投稿」ボタン押下
  2. 最新内容を保存（必要なら）
  3. `Share.share(text)` で共有シート表示
  4. ユーザーが X を選択 → テキストが貼られた状態で投稿画面が開く

---

## 10. 広告設計

### 10.1 使用パッケージ

- `google_mobile_ads`

### 10.2 広告ユニット

- バナー広告
  - 一覧画面下部
  - 編集画面下部

### 10.3 共通AdManager

- AdManagerクラスを作成し、広告初期化・ロード・Widget提供を担当
- 画面側は `AdManager.buildBannerAdWidget()` を配置するだけでよい

---

## 11. アーキテクチャ / ディレクトリ構成
```
lib/
  main.dart
  core/
    constants/
      app_colors.dart          # ダーク/ライト両テーマのカラーパレット
      app_dimens.dart
      db_constants.dart
      ad_unit_ids.dart
    theme/
      app_theme.dart           # ThemeData定義（ダーク/ライト）
    utils/
      date_formatter.dart
  data/
    db/
      app_database.dart
      draft_dao.dart
    models/
      draft.dart
  presentation/
    screens/
      draft_list_screen.dart
      draft_edit_screen.dart
      settings_screen.dart
    widgets/
      draft_list_item.dart     # ボーダー区切りのリストアイテム
      pill_button.dart         # ピル型ボタン（塗り / アウトライン）
      circular_char_counter.dart  # 円形プログレス文字カウンター
      x_app_bar.dart           # X風フラットAppBar
  ads/
    ad_manager.dart
```

---

## 12. 開発ステップ（推奨）

1. プロジェクト作成（Flutter）
2. `sqflite`, `path`, `google_mobile_ads`, `share_plus` を導入
3. AppDatabase と DraftDao 実装
4. Draftモデル・下書き一覧画面（G1）実装
5. 下書き編集画面（G2）の基本ロジック（TextField＋保存）実装
6. 文字数カウンター追加
7. `share_plus`でX投稿連携
8. ニューモーフィック共通Widget（カード・ボタン）を導入し、画面を差し替え
9. 広告の導入・表示確認
10. 設定画面（G3）実装（必要に応じて）