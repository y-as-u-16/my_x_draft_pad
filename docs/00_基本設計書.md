# X Draft Pad 設計書（Flutter + SQLite + 広告＋ニューモーフィズム）

## 1. アプリ概要

- **アプリ名（仮）**：X Draft Pad
- **プラットフォーム**：Android / iOS（Flutter）
- **目的**：
  - X（旧Twitter）に投稿するテキストの下書き・管理
  - 文字数（Xの投稿上限）を意識しながら推敲できる
  - ワンタップでXに投稿できる
  - 広告（AdMob）による収益化
- **UIコンセプト**：
  - ニューモーフィズム（Neumorphism） をベースにした柔らかいカード・ボタン
  - シンプルで集中しやすいライティング環境
  - 余白多め・色数少なめ

---

## 2. 要件定義

### 2.1 機能要件

#### F-1. 下書き作成・編集

- 複数行テキスト入力
- リアルタイム文字数カウント
  - 総文字数
  - 残り文字数（デフォルト280）
  - 上限超過時は残り数値を赤表示
- 下書き保存（新規・更新）

#### F-2. 下書き一覧

- SQLiteに保存された下書き一覧表示（新しい順）
- 表示項目：
  - 先頭数十文字（例：30文字）
  - 更新日時
- 操作：
  - タップ → 編集画面へ遷移
  - スワイプ削除 or 長押し削除

#### F-3. Xへの投稿

- 編集画面の「Xで投稿」ボタンから
- OS共有シートを利用してXアプリの投稿画面にテキストを渡す
- 公式APIは使用しない

#### F-4. 設定

- 上限文字数の変更
  - デフォルト：280
- テーマ切り替え（ライト / ダーク）※対応可能な範囲で

#### F-5. 広告

- バナー広告表示
  - 一覧画面下部
  - 編集画面下部

### 2.2 非機能要件

- オフライン動作（SQLiteのみで完結）
- 操作レスポンスの良さ
- 端末ローカル保存のため、ユーザーの文章を外部送信しない
- 将来的にバックエンド連携（Firebase / Supabase）を追加できる設計

---

## 3. UI設計（ニューモーフィズム）

### 3.1 カラーパレット（ライトテーマ例）

| 用途 | カラーコード |
|------|-------------|
| 背景 | `#E0E5EC`（明るいグレー） |
| ベースカード | `#E0E5EC`（背景とほぼ同色） |
| 文字色（メイン） | `#333333` |
| サブテキスト | `#777777` |
| アクセント | `#1DA1F2`（Xブルー） |
| 警告（文字数超過） | `#E53935` |

### 3.2 ニューモーフィックスタイル

**ベース**：
- 背景と同系色のカードを使い、影で立体感を出す

**共通パラメータ例**：
- 角丸：`BorderRadius.circular(16)`
- 影（outer）：
  - 明るい側：`Offset(-4, -4), color: Colors.white.withOpacity(0.8)`
  - 暗い側：`Offset(4, 4), color: Colors.black.withOpacity(0.15)`
- 影（inner）：
  - TextField・ボタン押下時などで使用

### 3.3 画面ごとのUIコンセプト

#### G1：下書き一覧画面

- **背景**：単色（`#E0E5EC`）
- **AppBar**：
  - フラットではなく、ニューモーフィックなコンテナとして配置
- **下書き一覧**：
  - 各アイテムを丸みのあるカードとして表示
  - 左端に薄いインジケータ（更新日時など）
- **FAB**：
  - 丸い浮遊ボタンをニューモーフィックスタイルで表現
  - アイコン：`+`
  - 陰影を強めにして、押せる感を出す

#### G2：下書き編集画面

- **画面上部**：
  - AppBarはややフラット寄り、背景と同系色
- **テキスト入力エリア**：
  - 角丸の大きなニューモーフィックコンテナ内にTextField
  - 余白多めで「紙」のような印象
- **下部ステータスバー**：
  - 小さなニューモーフィックバーに文字数を表示
- **操作ボタン**：
  - 下書き保存、Xで投稿 を並べたピル型ボタン
  - 通常時はベース色＋影、押下時はインナーシャドウで凹んだ表現

#### G3：設定画面

- 各設定項目を例によってニューモーフィックカード化
- スイッチやスライダーもニューモーフィック風に

---

## 4. 画面構成

### 4.1 画面一覧

1. **G1**：下書き一覧画面
2. **G2**：下書き編集画面
3. **G3**：設定画面

### 4.2 G1：下書き一覧画面

**機能**：
- 下書き一覧表示
- 下書き新規作成
- 下書き削除
- 設定画面への遷移

**UI構成**：
- AppBar（タイトル＋設定アイコン）
- ListView（ニューモーフィックカードのリスト）
- 右下にニューモーフィックFAB（新規）
- 最下部にバナー広告領域

### 4.3 G2：下書き編集画面

**機能**：
- 下書き新規作成 / 編集
- 文字数カウント
- Xへの投稿
- 下書き保存

**UI構成**：
- AppBar（戻る＋保存アイコン）
- 上部余白
- 中央：大きなニューモーフィックTextFieldコンテナ
- 下部ステータスバー（現在文字数 / 残り文字数）
- 最下部：横並びのニューモーフィックボタン (保存, Xで投稿)
- バナー広告

### 4.4 G3：設定画面

**機能**：
- 上限文字数設定
- テーマ切り替え

**UI構成**：
- AppBar（タイトルのみ）
- 設定項目ごとにニューモーフィックカード
  - 上限文字数：ラベル＋テキストフィールド or スライダー
  - テーマ切り替え：ラベル＋トグルスイッチ

---

## 5. データ設計（SQLite）

### 5.1 テーブル一覧

- **drafts**：下書きデータ本体
- **app_settings**：アプリ設定

### 5.2 drafts テーブル

**テーブル名**：`drafts`

| カラム名 | 型 | NOT NULL | 主キー | 説明 |
|---------|-----|----------|--------|------|
| id | INTEGER | YES | YES | 自動採番ID |
| content | TEXT | YES | | 下書き本文 |
| created_at | INTEGER | YES | | 作成日時（epoch millis） |
| updated_at | INTEGER | YES | | 更新日時（epoch millis） |

**CREATE TABLE 例**
```sql
CREATE TABLE drafts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  content TEXT NOT NULL,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
);
```

### 5.3 app_settings テーブル（任意）

**テーブル名**：`app_settings`

| カラム名 | 型 | NOT NULL | 主キー | 説明 |
|---------|-----|----------|--------|------|
| key | TEXT | YES | YES | 設定キー |
| value | TEXT | YES | | 設定値（JSONや文字列） |

**例**：
- `("max_length", "280")`

---

## 6. モデル設計（Dart）

### 6.1 Draft モデル
```dart
class Draft {
  final int? id;
  final String content;
  final DateTime createdAt;
  final DateTime updatedAt;

  Draft({
    this.id,
    required this.content,
    required this.createdAt,
    required this.updatedAt,
  });

  Draft copyWith({
    int? id,
    String? content,
    DateTime? createdAt,
    DateTime? updatedAt,
  }) {
    return Draft(
      id: id ?? this.id,
      content: content ?? this.content,
      createdAt: createdAt ?? this.createdAt,
      updatedAt: updatedAt ?? this.updatedAt,
    );
  }

  factory Draft.fromMap(Map<String, dynamic> map) {
    return Draft(
      id: map['id'] as int?,
      content: map['content'] as String,
      createdAt: DateTime.fromMillisecondsSinceEpoch(map['created_at'] as int),
      updatedAt: DateTime.fromMillisecondsSinceEpoch(map['updated_at'] as int),
    );
  }

  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'content': content,
      'created_at': createdAt.millisecondsSinceEpoch,
      'updated_at': updatedAt.millisecondsSinceEpoch,
    };
  }
}
```

---

## 7. SQLiteアクセス設計

### 7.1 使用パッケージ

- `sqflite`
- `path`

### 7.2 AppDatabase クラス

**責務**：
- DBインスタンスのシングルトン管理
- テーブル作成 / マイグレーション

**メソッド例**：
- `Future<Database> get database`
- `_onCreate(Database db, int version)`
- `_onUpgrade(Database db, int oldVersion, int newVersion)`

### 7.3 DraftDao クラス

**責務**：
- draftsテーブルのCRUD

**メソッド例**：
```dart
abstract class DraftDao {
  Future<int> insertDraft(Draft draft);
  Future<int> updateDraft(Draft draft);
  Future<int> deleteDraft(int id);
  Future<List<Draft>> getAllDrafts();
  Future<Draft?> getDraftById(int id);
}
```

実装クラスで sqflite を利用。

---

## 8. 文字数カウント仕様

- **カウント対象**：`String.characters.length`（絵文字を1文字としてカウント）
- **上限文字数**：設定値（デフォルト280）
- **表示**：
  - 現在文字数：`124`
  - 残り文字数：`+156`（上限 − 現在）
  - 超過時：`-10`（赤色表示）

---

## 9. X投稿連携仕様

- **パッケージ**：`share_plus`（予定）
- **フロー**：
  1. 「Xで投稿」ボタン押下
  2. 最新内容を保存（必要なら）
  3. `Share.share(text)` で共有シート表示
  4. ユーザーが X を選択 → テキストが貼られた状態で投稿画面が開く

---

## 10. 広告設計

### 10.1 使用パッケージ

- `google_mobile_ads`

### 10.2 広告ユニット

- バナー広告
  - 一覧画面下部
  - 編集画面下部

### 10.3 共通AdManager

- AdManagerクラスを作成し、広告初期化・ロード・Widget提供を担当
- 画面側は `AdManager.buildBannerAdWidget()` を配置するだけでよい

---

## 11. アーキテクチャ / ディレクトリ構成
```
lib/
  main.dart
  core/
    constants/
      app_colors.dart
      app_dimens.dart
      db_constants.dart
      ad_unit_ids.dart
    utils/
      date_formatter.dart
      neumorphic_decorations.dart
  data/
    db/
      app_database.dart
      draft_dao.dart
    models/
      draft.dart
  presentation/
    screens/
      draft_list_screen.dart
      draft_edit_screen.dart
      settings_screen.dart
    widgets/
      draft_list_item.dart
      neumorphic_button.dart
      neumorphic_card.dart
      neumorphic_text_field_shell.dart
      character_counter.dart
  ads/
    ad_manager.dart
```

---

## 12. 開発ステップ（推奨）

1. プロジェクト作成（Flutter）
2. `sqflite`, `path`, `google_mobile_ads`, `share_plus` を導入
3. AppDatabase と DraftDao 実装
4. Draftモデル・下書き一覧画面（G1）実装
5. 下書き編集画面（G2）の基本ロジック（TextField＋保存）実装
6. 文字数カウンター追加
7. `share_plus`でX投稿連携
8. ニューモーフィック共通Widget（カード・ボタン）を導入し、画面を差し替え
9. 広告の導入・表示確認
10. 設定画面（G3）実装（必要に応じて）